## @section Upstream Loki configurations
##

loki:
  ## @param loki.enabled Enable loki
  enabled: true
  loki:
    deploymentMode: SingleBinary
    ## @param loki.loki.auth_enabled Enables authentication through the X-Scope-OrgID header
    auth_enabled: false
    ## @skip loki.loki.commonConfig.replication_factor
    commonConfig:
      replication_factor: 1
      ring:
        kvstore:
          store: memberlist
    ## @skip loki.loki.schemaConfig
    schemaConfig:
      configs:
        - from: "2025-05-28"
          store: boltdb-shipper
          object_store: filesystem
          schema: v13
          index:
            prefix: loki_index_
            period: 24h
    storage:
      ## @param loki.loki.storage.type Method to use for storage
      type: filesystem
      filesystem:
        chunks_directory: /var/loki/chunks
        rules_directory: /var/loki/rules
    storage_config:
      boltdb_shipper:
        active_index_directory: /var/loki/index
        cache_location: /var/loki/boltdb-cache
        shared_store: filesystem
      filesystem:
        directory: /var/loki/chunks
    ## @param loki.loki.limits_config.retention_period Retention period to apply to stored data.
    ## @param loki.loki.limits_config.reject_old_samples Reject old samples
    ## @param loki.loki.limits_config.reject_old_samples_max_age Reject old samples max age
    ## @param loki.loki.limits_config.max_streams_per_user Maximum number of streams per user
    ## @param loki.loki.limits_config.max_label_names_per_series Maximum number of label names per series
    ## @param loki.loki.limits_config.max_line_size Maximum line size
    limits_config:
      retention_period: 168h
      reject_old_samples: false
      reject_old_samples_max_age: 43800h
      max_streams_per_user: 10000
      max_label_names_per_series: 30
      max_line_size: 51
    ## @skip loki.test.enabled
    test:
      enabled: false
    ## @skip loki.gateway.enabled
    gateway:
      enabled: false
    ## @skip loki.monitoring
    monitoring:
      rules:
        enabled: false
      dashboards:
        enabled: false
      lokiCanary:
        enabled: false
      selfMonitoring:
        enabled: false
        grafanaAgent:
          installOperator: false
      serviceMonitor:
        enabled: false
    singleBinary:
      ## @param loki.singleBinary.replicas Number of replicas for the single binary
      replicas: 1
      ## @param loki.singleBinary.resources.requests.cpu CPU requests for promtail container
      ## @param loki.singleBinary.resources.requests.memory Memory requests for promtail container
      ## @param loki.singleBinary.resources.limits.cpu CPU limits for promtail container
      ## @param loki.singleBinary.resources.limits.memory Memory limits for promtail container
      resources:
        requests:
          cpu: 0.2
          memory: 810Mi
        limits:
          cpu: 0.4
          memory: 1620Mi
      ## @param loki.singleBinary.persistence.size Size of persistent disk
      ## @param loki.singleBinary.persistence.enableStatefulSetAutoDeletePVC Enable StatefulSetAutoDeletePVC feature
      persistence:
        enableStatefulSetAutoDeletePVC: false
        size: 50Gi
    write:
      replicas: 0
    read:
      replicas: 0
    backend:
      replicas: 0
    
    resultsCache:
      enabled: false

    memcachedExporter:
      enabled: false

    lokiCanary:
      enabled: false

    chunksCache:
      enabled: false


promtail:
  ## @param promtail.enabled Enable promtail
  enabled: true
  ## @skip promtail.image
  # image:
  #   tag: 2.9.10
  ## @param promtail.priorityClassName Priority class name for promtail DaemonSet
  priorityClassName: system-node-critical
  config:
    clients:
      ## @param promtail.config.clients[0].url Loki push API URL
      - url: http://loki:3100/loki/api/v1/push
    snippets:
      ## @skip promtail.config.snippets.extraRelabelConfigs
      extraRelabelConfigs:
        - regex: __meta_kubernetes_pod_label_(.+)
          action: labelmap
  ## @param promtail.resources.requests.cpu CPU requests for promtail container
  ## @param promtail.resources.requests.memory Memory requests for promtail container
  ## @param promtail.resources.requests.ephemeral-storage Ephemeral storage requests for promtail container
  ## @param promtail.resources.limits.cpu CPU limits for promtail container
  ## @param promtail.resources.limits.memory Memory limits for promtail container
  resources:
    requests:
      cpu: 100m
      memory: 512Mi
      ephemeral-storage: 256Mi
    limits:
      cpu: 200m
      memory: 1024Mi
  tolerations:
    ## @skip promtail.tolerations[0]
    - key: node-role.kubernetes.io/master
      effect: NoSchedule
      operator: Exists
    ## @skip promtail.tolerations[1]
    - key: node-role.kubernetes.io/control-plane
      effect: NoSchedule
      operator: Exists
    ## @skip promtail.tolerations[2]
    - effect: NoSchedule
      operator: Exists
    ## @skip promtail.tolerations[3]
    - key: CriticalAddonsOnly
      operator: Exists
    ## @skip promtail.tolerations[4]
    - effect: NoExecute
      operator: Exists
